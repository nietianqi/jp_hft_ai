# Kabu HFT 快速参考手册

最后更新: 2025-12-01

---

## 📋 快速回答你的5个问题

### 1️⃣ 项目结构合理吗清晰吗?

✅ **非常合理清晰** (9/10分)

```
结构优点:
✓ 清晰的分层架构 (config/models/strategy/execution/engine)
✓ 职责分离明确
✓ 符合最佳实践
✓ 文档完整(5个MD文档)
```

### 2️⃣ 有冗余文件吗?

⚠️ **有少量冗余**

```
冗余文件:
- strategy/original/enhanced_long_strategy.py (392行,未使用)
- config/trading_config.py (8个参数未使用)

建议: 归档或删除
```

### 3️⃣ 有缺少的文件吗?

⚠️ **缺少一些重要文件**

```
已添加:
✓ .gitignore (新建)
✓ config/system_config.example.py (新建)
✓ tests/test_meta_manager.py (新建,已通过7个测试)

仍缺少:
- 性能监控工具
- 回测框架
- 更多单元测试
```

### 4️⃣ 策略可以吗?

✅ **策略设计合理,可以使用** (8/10分)

```
三大策略:
1. Market Making (做市) - 30%权重
   ✓ 提供流动性赚价差
   ✓ 波动率自适应
   ✓ 库存风险管理

2. Liquidity Taker (流动性抢占) - 40%权重
   ✓ 主动吃单
   ✓ 盘口失衡检测
   ✓ 时间止损保护

3. Order Flow (订单流) - 30%权重
   ✓ 跟随主力资金
   ✓ 市场压力分析
   ✓ 已修复字段依赖问题

策略互补,多层风控 ✓
```

### 5️⃣ 配置的止盈是多少?

📊 **止盈: 2 ticks = 0.2日元**

```
详细配置:
├─ 止盈 (take_profit_ticks): 2 ticks
│  └─ 约 20日元/手 (100股)
│
├─ 止损 (stop_loss_ticks): 100 ticks
│  └─ 约 1,000日元/手 (100股)
│
├─ 盈亏比: 1:50
│  └─ 需要胜率 > 98%
│
└─ 时间止损: 5秒 (流动性抢占/订单流)

⚠️ 这是典型HFT配置: 小止盈+高频率+高胜率
```

---

## 🎯 关键配置一览表

### 风控参数 (config/strategy_config.py)

| 参数 | 值 | 说明 |
|------|-----|------|
| `take_profit_ticks` | 2 | 止盈 (0.2日元) |
| `stop_loss_ticks` | 100 | 止损 (10日元) |
| `max_total_position` | 400股 | 最大总仓位 |
| `daily_loss_limit` | 500,000日元 | 日亏损限额 |
| `strategy_loss_limit` | 100,000日元 | 单策略限额 |
| `profit_target` | 200,000日元 | 盈利目标 |

### 策略权重

```python
market_making: 30%      # 做市
liquidity_taker: 40%    # 流动性抢占(主要)
orderflow_queue: 30%    # 订单流
```

---

## 🚀 快速启动指南

### 模拟测试

```bash
python main.py
```

### 真实环境

```bash
# 1. 配置API密码
cp config/system_config.example.py config/system_config.py
# 编辑 config/system_config.py, 填写API密码

# 2. 启动真实交易
python run_live.py
```

---

## ✅ 测试验证

### 运行单元测试

```bash
python tests/test_meta_manager.py
```

预期输出:
```
✓ 测试1通过: 正常买入
✓ 测试2通过: 超限拒绝
✓ 测试3通过: 有仓位时的限制
✓ 测试4通过: 空头仓位限制
✓ 测试5通过: 平仓允许
✓ 测试6通过: 绝对仓位上限检查
✓ 测试7通过: 达限后平仓允许
✓ 测试8通过: 超限后可减仓(3000→2000)
✓ 测试9通过: 继续减仓(2000→1000)
✓ 测试10通过: 完全平仓(1000→0)
✓ 测试11通过: 超策略限额拒绝增仓
✅ 所有测试通过!
```

---

## 📁 重要文档索引

| 文档 | 用途 |
|------|------|
| `PROJECT_ANALYSIS.md` | **完整项目分析** (本次新建) |
| `CODE_REVIEW_AND_FIXES.md` | 代码审查报告 |
| `FINAL_SUMMARY.md` | 最终总结 |
| `LATEST_FIXES.md` | 真实环境对接 |
| `README.md` | 项目说明 |

---

## ⚠️ 风险提醒

### 止盈止损分析

当前配置:**高风险高频策略**

```
盈亏比 1:50 意味着:
- 每赚 20日元 (2 ticks止盈)
- 可能亏 1,000日元 (100 ticks止损)
- 必须保持 98%+ 胜率

适合场景:
✓ 流动性好的市场
✓ 价差稳定
✓ 高频快速进出

不适合:
✗ 剧烈波动市场
✗ 低流动性标的
✗ 单边趋势行情
```

### 使用建议

1. **从小仓位开始**: 100股测试
2. **严格监控**: 前3天每小时检查
3. **准备止损**: 手动平仓预案
4. **回测验证**: 参数需要历史数据验证

---

## 🎉 系统状态

### 已完成 ✅

- [x] 代码可以运行
- [x] 策略逻辑正确
- [x] 仓位管理修复
- [x] 真实API对接成功
- [x] WebSocket实时数据正常
- [x] 单元测试通过
- [x] 文档完整

### 建议补充 📝

- [ ] 更多单元测试
- [ ] 性能监控工具
- [ ] 回测框架
- [ ] 参数优化
- [ ] 充分的实盘测试

---

## 📞 紧急处理

### 如果出现异常大量下单

```bash
1. 立即按 Ctrl+C 停止程序
2. 在kabuSTATION中手动撤销所有订单
3. 手动平掉所有持仓
4. 检查日志找原因
```

### 常见问题

**Q: API连接失败?**
A: 检查kabuSTATION是否启动,API密码是否正确

**Q: 仓位失控?**
A: 已修复,运行`tests/test_meta_manager.py`验证

**Q: 止盈太小?**
A: 这是HFT配置,可调整为5-10 ticks更保守

---

**准备好了吗? 祝交易顺利! 🚀**

(记住: 从100股小仓位开始!)
